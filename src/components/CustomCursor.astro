---
// カスタムカーソルコンポーネント
// プロジェクト全体で使用するカスタムカーソル機能
---

<style is:global>
  /* ===== カスタムカーソル設定 ===== */
  
  /* デフォルトカーソルは初期状態では表示 */
  /* マウス移動時にカスタムカーソルが有効になったら非表示にする */
  
  /* モバイルデバイスではカスタムカーソルを無効化 */
  @media (max-width: 768px) {
    * {
      cursor: auto !important;
    }
    .custom-cursor-container {
      display: none !important;
    }
  }
  
  /* 現在のカスタムカーソル（円形と四角形）を無効化 */
  /*
  .cursor-outer {
    width: 27px;
    height: 27px;
    border: 1px solid #303030;
    border-radius: 50%;
    position: fixed;
    pointer-events: none;
    z-index: 99999;
    transition: left 0.4s ease, top 0.4s ease, transform 0.3s ease; 
    opacity: 0;
  }
  



  .cursor-inner {
    width: 22px;
    height: 22px;
    border: 1px solid #000000;
    position: fixed;
    pointer-events: none;
    z-index: 99999;
    transition: left 0.1s ease, top 0.1s ease, transform 0.1s ease; 
    opacity: 0;
  }
  */

  /* 新しい正方形カーソル */
  .cursor-square {
    width: 15px;
    height: 15px;
    border: 1px solid #1F222D;
    position: fixed;
    pointer-events: none;
    z-index: 99999;
    transition: left 0.1s ease, top 0.1s ease, transform 0.25s ease; 
    opacity: 0;
  }
  
  /* カスタムカーソルが有効になった時のスタイル */
  .custom-cursor-active .cursor-square {
    opacity: 1;
    border-color: #1F222D;
  }
  
  .custom-cursor-active * {
    cursor: none !important;
  }
  
  /* より強力なカーソル非表示ルール */
  .custom-cursor-active,
  .custom-cursor-active *,
  .custom-cursor-active a,
  .custom-cursor-active button,
  .custom-cursor-active [data-hover] {
    cursor: none !important;
  }
  
  /* ホバー時の透明度 */
  /* .cursor-square:hover,
  .custom-cursor-active .cursor-square[style*="rotate"] {
    opacity: 0.45 !important;
  }
   */
  /* ダークモード時のカーソルカラー反転 */
  body.dark .cursor-square {
    border-color: #ffffff;
  }

</style>

<div class="custom-cursor-container">
  <!-- カーソル要素はJavaScriptで動的に生成 -->
</div>

<script>
  // カスタムカーソル機能
  class CustomCursor {
    private square: HTMLElement | null = null;
    private isActive: boolean = false;
    
    constructor() {
      this.init();
    }
    
    init() {
      if (window.innerWidth <= 768) return;
      
      // ローディング画面ではカスタムカーソルを無効化
      if (window.location.pathname === '/loading') return;
      
      this.createElements();
      this.bindEvents();
    }
    
    createElements() {
      this.square = document.createElement('div');
      this.square.className = 'cursor-square';
      document.body.appendChild(this.square);
    }
    
    bindEvents() {
      // マウス追従とカスタムカーソルの有効化
      document.addEventListener('mousemove', (e) => {
        if (this.square) {
          // カスタムカーソルを有効化
          if (!this.isActive) {
            this.activateCustomCursor();
          }
          
          // カーソル位置を更新
          this.square.style.left = (e.clientX - 11) + 'px';
          this.square.style.top = (e.clientY - 11) + 'px';
        }
      });

      // ホバー効果（135度回転）
      document.addEventListener('mouseenter', (e) => {
        const target = e.target as HTMLElement;
        if (target && (target.tagName === 'A' || target.tagName === 'BUTTON' || target.hasAttribute('data-hover'))) {
          if (this.square) {
            this.square.style.transform = 'rotate(135deg)';
            this.square.style.opacity = '0.85';
          }
        }
      }, true);
      
      document.addEventListener('mouseleave', (e) => {
        const target = e.target as HTMLElement;
        if (target && (target.tagName === 'A' || target.tagName === 'BUTTON' || target.hasAttribute('data-hover'))) {
          if (this.square) {
            this.square.style.transform = 'rotate(0deg)';
            this.square.style.opacity = '1';
          }
        }
      }, true);
    }
    
    activateCustomCursor() {
      this.isActive = true;
      document.documentElement.classList.add('custom-cursor-active');
      
      // より確実にデフォルトカーソルを非表示にする
      document.body.style.cursor = 'none';
      document.documentElement.style.cursor = 'none';
    }
  }

  // シンプルな初期化関数
  function initCursor() {
    if (typeof document !== 'undefined') {
      new CustomCursor();
    }
  }

  // 基本的な初期化
  initCursor();
  document.addEventListener('DOMContentLoaded', initCursor);
  document.addEventListener('astro:page-load', initCursor);
</script> 